<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Formulario de Contacto - Plataforma B2B</title>
    <link rel="stylesheet" href="contactar.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="title-section">
                <h1>Solicitar Cotización</h1>
                <p>Complete el formulario para enviar una cotización personalizada</p>
            </div>
        </div>

        <form class="quotation-form" id="quotationForm" action="/enviar-contacto" method="POST">
            <input type="hidden" name="productoId" id="productoId">
            <input type="hidden" name="nombreProducto" id="nombreProducto">

            <div class="card">
                <input type="hidden" name="correoVendedor" id="correoVendedor">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                        Información del Comprador
                    </h2>
                    <p class="card-description">Proporcione sus datos de contacto y información empresarial</p>
                </div>
                <div class="card-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="buyerName">Nombre completo *</label>
                            <input type="text" id="buyerName" name="buyerName" placeholder="Ej: Juan Pérez" required>
                        </div>

                        <div class="form-group">
                            <label for="buyerEmail">Correo electrónico *</label>
                            <input type="email" id="buyerEmail" name="buyerEmail" placeholder="juan@empresa.com"
                                required>
                        </div>

                        <div class="form-group">
                            <label for="buyerPhone">Teléfono *</label>
                            <input type="tel" id="buyerPhone" name="buyerPhone" placeholder="+52 55 1234 5678" required>
                        </div>

                        <div class="form-group">
                            <label for="position">Cargo/Posición</label>
                            <input type="text" id="position" name="position" placeholder="Ej: Gerente de Compras">
                        </div>

                        <div class="form-group">
                            <label for="companyName">Nombre de la empresa *</label>
                            <input type="text" id="companyName" name="companyName" placeholder="Ej: Industrias ABC S.A."
                                required>
                        </div>

                        <div class="form-group">
                            <label for="businessType">Tipo de negocio</label>
                            <select id="businessType" name="businessType">
                                <option value="">Seleccione el tipo</option>
                                <option value="manufacturer">Manufacturero</option>
                                <option value="distributor">Distribuidor</option>
                                <option value="retailer">Minorista</option>
                                <option value="wholesaler">Mayorista</option>
                                <option value="service">Servicios</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                        Información de Ubicación
                    </h2>
                </div>
                <div class="card-content">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="address">Dirección</label>
                            <input type="text" id="address" name="address" placeholder="Calle, número, colonia">
                        </div>

                        <div class="form-group">
                            <label for="city">Ciudad</label>
                            <input type="text" id="city" name="city" placeholder="Ciudad">
                        </div>

                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" />
                            <path d="m3.3 7 8.7 5 8.7-5" />
                            <path d="M12 22V12" />
                        </svg>
                        Información del Producto
                    </h2>
                    <p class="card-description">Detalles específicos del producto que desea cotizar</p>
                </div>
                <div class="card-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="productName">Nombre del producto *</label>
                            <input type="text" id="productName" name="productName"
                                placeholder="Ej: Tornillos hexagonales M8" required>
                        </div>

                        <div class="form-group">
                            <label for="productCategory">Categoría</label>
                            <select id="productCategory" name="productCategory">
                                <option value="">Seleccione categoría</option>
                                <option value="electronics">Electrónicos</option>
                                <option value="machinery">Maquinaria</option>
                                <option value="materials">Materiales</option>
                                <option value="tools">Herramientas</option>
                                <option value="chemicals">Químicos</option>
                                <option value="textiles">Textiles</option>
                                <option value="food">Alimentos</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="quantity">Cantidad requerida *</label>
                            <input type="number" id="quantity" name="quantity" placeholder="1000" required>
                        </div>

                        <div class="form-group">
                            <label for="quantityUnit">Unidad de medida</label>
                            <select id="quantityUnit" name="quantityUnit">
                                <option value="">Seleccione unidad</option>
                                <option value="pieces">Piezas</option>
                                <option value="kg">Kilogramos</option>
                                <option value="tons">Toneladas</option>
                                <option value="liters">Litros</option>
                                <option value="meters">Metros</option>
                                <option value="boxes">Cajas</option>
                                <option value="pallets">Pallets</option>
                            </select>
                        </div>

                    </div>
                </div>
            </div>


            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M3 21h18" />
                            <path d="M5 21V7l8-4v18" />
                            <path d="M19 21V11l-6-4" />
                        </svg>
                        Detalles Comerciales
                    </h2>
                </div>
                <div class="card-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="deliveryLocation">Lugar de entrega</label>
                            <input type="text" id="deliveryLocation" name="deliveryLocation"
                                placeholder="Ciudad, Estado, País">
                        </div>

                        <div class="form-group">
                            <label for="expectedDeliveryDate">Fecha esperada de entrega</label>
                            <input type="date" id="expectedDeliveryDate" name="expectedDeliveryDate">
                        </div>

                        <div class="form-group">
                            <label for="paymentTerms">Términos de pago preferidos</label>
                            <select id="paymentTerms" name="paymentTerms">
                                <option value="">Seleccione términos</option>
                                <option value="cash">Contado</option>
                                <option value="30days">30 días</option>
                                <option value="60days">60 días</option>
                                <option value="90days">90 días</option>
                                <option value="letter_credit">Carta de crédito</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="urgency">Urgencia de la cotización</label>
                            <select id="urgency" name="urgency">
                                <option value="">Seleccione urgencia</option>
                                <option value="low">Baja - 1-2 semanas</option>
                                <option value="medium">Media - 3-5 días</option>
                                <option value="high">Alta - 24-48 horas</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="specifications">Especificaciones técnicas</label>
                        <textarea id="specifications" name="specifications" rows="4"
                            placeholder="Describa las especificaciones técnicas, dimensiones, materiales, certificaciones requeridas, etc."></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="additionalRequirements">Requisitos adicionales</label>
                        <textarea id="additionalRequirements" name="additionalRequirements" rows="3"
                            placeholder="Mencione cualquier requisito especial, certificaciones, embalaje, documentación, etc."></textarea>
                    </div>
                </div>
            </div>


            <div class="form-actions">


                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary">
                        <svg class="icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="m22 2-7 20-4-9-9-4Z" />
                            <path d="M22 2 11 13" />
                        </svg>
                        Enviar solicitud de cotización
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Obtener el productoId de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const productoId = urlParams.get('id');
        document.getElementById('productoId').value = productoId;

        let datosListos = false;

        // Obtener los datos del producto y del vendedor
        fetch(`/api/contacto-info/${productoId}`)
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Data recibida:', data);
                if (data.success) {
                    document.getElementById('correoVendedor').value = data.correoVendedor;
                    document.getElementById('nombreProducto').value = data.producto.nombre;
                    datosListos = true;
                    console.log('Datos cargados correctamente');
                } else {
                    console.error('Error en la respuesta:', data.message);
                    alert('Error al obtener los datos del producto');
                }
            })
            .catch(error => {
                console.error('Error en fetch:', error);
                alert('Error de conexión');
            });

        // Prevenir el envío del formulario si aún no están los datos cargados
        document.getElementById('quotationForm').addEventListener('submit', function (event) {
            const correoVendedor = document.getElementById('correoVendedor').value;

            console.log('Estado de envío:', {
                datosListos,
                correoVendedor,
                formularioValido: this.checkValidity()
            });

            if (!datosListos || !correoVendedor) {
                event.preventDefault();
                alert('Por favor espera a que se cargue la información del vendedor antes de enviar el formulario.');
                return;
            }

            // Validar campos requeridos
            if (!this.checkValidity()) {
                event.preventDefault();
                alert('Por favor completa todos los campos requeridos.');
                return;
            }

            console.log('Formulario enviado correctamente');
            window.location.href = 'mensaje-exito.html';
        });
    </script>
</body>

</html>